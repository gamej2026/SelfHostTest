# Unity 로그인 문제 해결 방법

## 문제 설명

GitHub Actions 워크플로가 실행될 때마다 Unity 계정에 로그인을 시도하여, 7번의 연속된 로그인 실패로 인해 Unity ID가 일시적으로 잠겼습니다.

## 원인

기존 워크플로는 매번 빌드를 실행할 때마다 다음과 같은 동작을 수행했습니다:

1. Unity 라이센스 활성화 단계에서 항상 `UNITY_EMAIL`과 `UNITY_PASSWORD`를 사용하여 로그인 시도
2. 이미 유효한 라이센스가 있어도 매번 재활성화를 시도
3. 여러 번의 빌드가 실행되면서 반복적인 로그인 시도가 발생
4. Unity 서버가 이를 비정상적인 활동으로 감지하여 계정 잠금

## 해결 방법

워크플로를 수정하여 다음과 같이 동작하도록 변경했습니다:

### 수정된 로직

1. **라이센스 상태 확인 먼저 수행**
   - Unity를 실행하여 현재 라이센스가 유효한지 먼저 확인
   - 로그 파일에서 "No valid Unity Editor license found" 오류가 있는지 검사

2. **조건부 활성화**
   - 유효한 라이센스가 이미 있으면: 활성화 단계를 건너뛰고 "재활성화를 건너뜁니다" 메시지 출력
   - 유효한 라이센스가 없으면: `UNITY_EMAIL`과 `UNITY_PASSWORD`로 활성화 시도

3. **활성화 후 재확인**
   - 활성화를 시도한 경우, 다시 한 번 라이센스 상태를 확인하여 성공 여부 검증

### 주요 변경 사항

#### Windows (PowerShell)
```powershell
# 먼저 라이센스 상태 확인
$licenseValid = $false
if (라이센스 테스트 성공) {
    $licenseValid = $true
    Write-Host "Unity 라이센스가 이미 활성화되어 있습니다. 재활성화를 건너뜁니다."
}

# 라이센스가 없을 때만 활성화 시도
if (-not $licenseValid -and $unityEmail -and $unityPassword) {
    # 활성화 로직 실행
}
```

#### macOS (Bash)
```bash
# 먼저 라이센스 상태 확인
LICENSE_VALID=false
if (라이센스 테스트 성공); then
    LICENSE_VALID=true
    echo "Unity 라이센스가 이미 활성화되어 있습니다. 재활성화를 건너뜁니다."
fi

# 라이센스가 없을 때만 활성화 시도
if [ "$LICENSE_VALID" != "true" ] && [ -n "$UNITY_EMAIL" ] && [ -n "$UNITY_PASSWORD" ]; then
    # 활성화 로직 실행
fi
```

## 기대 효과

1. **로그인 시도 횟수 감소**: 이미 라이센스가 있으면 로그인하지 않으므로 불필요한 로그인 시도가 없어집니다
2. **계정 잠금 방지**: 반복적인 로그인 시도로 인한 계정 잠금 문제가 해결됩니다
3. **빌드 속도 향상**: 불필요한 라이센스 활성화 단계를 건너뛰어 빌드 시간이 단축됩니다
4. **안정성 향상**: 첫 번째 빌드에서 라이센스를 한 번만 활성화하면, 이후 빌드는 기존 라이센스를 재사용합니다

## 추가 권장 사항

1. **계정 잠금 해제 대기**: 현재 계정이 잠겨있다면 이메일에 명시된 대로 10분 후에 다시 시도할 수 있습니다

2. **시크릿 확인**: `UNITY_EMAIL`과 `UNITY_PASSWORD` 시크릿이 올바르게 설정되어 있는지 확인하세요
   - GitHub 저장소 → Settings → Secrets and variables → Actions
   - 잘못된 자격 증명이 있다면 업데이트하세요

3. **수동 라이센스 활성화 옵션**: Self-hosted runner에서 Unity를 수동으로 활성화한 경우, 시크릿을 설정하지 않아도 됩니다
   - 수동으로 활성화된 라이센스는 워크플로에서 자동으로 인식됩니다

## 테스트 방법

이 수정 사항을 테스트하려면:

1. 변경 사항을 main 브랜치에 푸시
2. GitHub Actions 워크플로가 자동으로 실행됨
3. 로그에서 다음 메시지를 확인:
   - 첫 번째 빌드: "Unity 라이센스를 EMAIL/PASSWORD로 활성화합니다..."
   - 두 번째 이후 빌드: "Unity 라이센스가 이미 활성화되어 있습니다. 재활성화를 건너뜁니다."

## 문의

문제가 계속되거나 추가 지원이 필요한 경우:
- GitHub Issues에 문제를 보고해주세요
- Unity 지원팀 (support.unity3d.com)에 문의하세요
